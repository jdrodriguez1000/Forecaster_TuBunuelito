general:
  random_state: 42
  base_path: "."
  data_raw_path: "data/01_raw"
  data_cleansed_path: "data/02_cleansed"
  data_features_path: "data/03_features"
  data_processed_path: "data/04_processed"
  outputs_path: "outputs"
  tests_reports_path: "tests/reports"
  mode: "train" # Opciones: load, train, forecast

extractions:
  tables: ["ventas", "inventario", "finanzas", "marketing", "macroeconomia", "clima"]
  schemas:
    ventas:
      fecha: datetime
      unidades_totales: int
      unidades_pagas: int
      unidades_bonificadas: int
      es_promocion: int
      ads_activos: int
    inventario:
      fecha: datetime
      kit_inicial_bodega: int
      kit_recibido: int
      lbs_recibidas: int
      demanda_teorica_total: int
      bu√±uelos_preparados: int
      ventas_reales_totales: int
      ventas_reales_pagas: int
      ventas_reales_bonificadas: int
      bu√±uelos_desperdiciados: int
      unidades_agotadas: int
      kit_final_bodega: int
    finanzas:
      fecha: datetime
      precio_unitario: int
      costo_unitario: float
      margen_bruto: float
      porcentaje_margen: float
    marketing:
      fecha: datetime
      inversion_total: int
      ig_cost: int
      fb_cost: int
      ig_pct: float
      fb_pct: float
      campa√±a_activa: int
    macroeconomia:
      fecha: datetime
      smlv: int
      inflacion_mensual_ipc: float
      tasa_desempleo: float
      trm: float
    clima:
      fecha: datetime
      temperatura_media: float
      probabilidad_lluvia: float
      precipitacion_mm: float
      tipo_lluvia: object
      evento_macro: object
      es_dia_lluvioso: int
  sentinel_values:
    numeric: [-999, 9999, -1]
    object: ["N/A", "NULL", "NONE", "UNKNOWN", "MISSING", "SIN_DATO", "", " "]
    datetime: ["1900-01-01", "1700-01-01", "9999-12-31", "2099-12-31"]

preprocessing:
  target_column: "demanda_teorica_total"
  date_column: "fecha"

eda:
  target_variable: "demanda_teorica_total"
  splits:
    test_days: 185
    val_days: 185
  time_series:
    lags_acf_pacf: 40
  statistics:
    vif_threshold: 10
    vif_columns:
      - "smlv"
      - "inflacion_mensual_ipc"
      - "tasa_desempleo"
      - "trm"
      - "temperatura_media"
      - "probabilidad_lluvia"
      - "precipitacion_mm"
      - "inversion_total"
      - "ig_cost"
      - "fb_cost"
      - "precio_unitario"
      - "costo_unitario"
  business_rules:
    pandemic:
      start: "2020-05-01"
      end: "2021-04-30"
    promotions:
      cycle_1_months: [4, 5]
      cycle_2_months: [9, 10]
      start_year: 2022
    events:
      novenas:
        month: 12
        days: [16, 26]
      semana_santa:
        jueves_viernes_santo: true # L√≥gica interna para festivos m√≥viles
      feria_flores:
        month: 8
        days: [1, 10]
    payments:
      quincenas: [15, 16, 30, 31]
      prima_legal:
        june: [15, 20]
        december: [15, 20]

features:
  # üéØ Configuraci√≥n General de la Fase
  target_variable: "demanda_teorica_total"
  id_columns: ["fecha"]
  
  # üóëÔ∏è Auditor√≠a de Columnas (Diccionario de Eliminaci√≥n)
  # Se eliminan por redundancia, multicolinealidad (VIF) o riesgo de leakage.
  drop_columns:
    - "unidades_totales"
    - "unidades_pagas"
    - "unidades_bonificadas"
    - "kit_inicial_bodega"
    - "kit_recibido"
    - "lbs_recibidas"
    - "bu√±uelos_preparados" # Peligro de Leakage (Decisi√≥n humana)
    - "ventas_reales_totales"
    - "ventas_reales_pagas"
    - "ventas_reales_bonificadas"
    - "bu√±uelos_desperdiciados"
    - "unidades_agotadas"
    - "kit_final_bodega"
    - "precio_unitario" # Consolidado en ratio de asequibilidad
    - "costo_unitario" # Consolidado en ratio de vulnerabilidad
    - "margen_bruto"
    - "ig_cost"
    - "fb_cost"
    - "ig_pct"
    - "fb_pct"
    - "probabilidad_lluvia"
    - "precipitacion_mm"
    - "ads_activos"      # Redundante con Campa√±a Activa/Inversi√≥n
    - "smlv"            # Consolidado en Ratios de Asequibilidad/Crecimiento
    - "trm"             # Consolidado en Vulnerabilidad TRM
    - "es_dia_lluvioso" # Redundante con Heavy/Light Rain
    - "campa√±a_activa"  # Correlaci√≥n 0.99 con Inversi√≥n Total
    - "inflacion_mensual_ipc" # Variable padre (VIF Infinity)
    - "precio_var_pct" # Componente de ratio (VIF Infinity)
    - "smlv_var_pct"   # Componente de ratio (VIF Infinity)
    - "inversion_total" # Sacrificada por Intensidad de Pauta (opcional si hay lag)

  # ‚úÖ Variables Base Proyectables
  base_columns:
    - "es_promocion"
    - "tasa_desempleo"
    - "porcentaje_margen"
    - "evento_macro"
    - "tipo_lluvia"
    - "temperatura_media"
    - "inversion_total" # Mantenemos Inversi√≥n como driver continuo principal

  # ‚ú® Transformaciones y Nuevas Se√±ales (T-1 strict)
  transformations:
    exogenous_lags:
      trm: 30 # El impacto del d√≥lar se percibe 30 d√≠as despu√©s (CCF Analysis)
    clima:
      persistence_window: 3 # D√≠as seguidos de lluvia (Efecto 'La Ni√±a')
      heavy_rain_threshold: "fuerte"
    momentum:
      ipc_lookback_days: 90 # Trimestre para calcular aceleraci√≥n de precios
    # Se elimina Fourier por redundancia con Flags de calendario y VIF infinito

  # üöÄ Ingenier√≠a para Simulaciones (Ratios Estrat√©gicos)
  simulation_ratios:
    asequibilidad:
      formula: "precio_unitario / (smlv / 30)"
    # Se eliminan ratios dependientes del target (se delegan a skforecast)
    vulnerability_trm:
      formula: "costo_unitario / trm_lag_30"

  # ‚õìÔ∏è Interacciones de Negocio (Drivers de Potencia)
  interactions:
    - ["es_promocion", "is_sunday"]
    - ["es_quincena", "is_heavy_rain"]
    # Se elimina interacci√≥n con inflacion por VIF Infinity de la variable padre

modeling:
  strategy: "ForecasterDirect"
  random_state: 42
  models:
    - "Ridge"
    - "RandomForestRegressor"
    - "LGBMRegressor"
    - "XGBRegressor"
    - "GradientBoostingRegressor"
    - "HistGradientBoostingRegressor"
  test_size: 185

monitoring:
  drift_threshold: 0.05
  retrain_period: 30
